CREATE TABLE IF NOT EXISTS dim_ssga_fund (
  ssga_fund_base_id BIGINT NOT NULL,
  ssga_fund_hist_id BIGINT NOT NULL,
  asof_calendar_day DATE,
  ssga_batch_base_id BIGINT NOT NULL,
  account_as_fund_flag STRING NOT NULL,
  fund_id BIGINT NOT NULL,
  portia_alias STRING,
  prks_alias STRING,
  aladdin_alias STRING,
  champs_alias STRING,
  accounting_system STRING,
  cost_center STRING,
  fund_domicile STRING,
  legal_name STRING,
  legal_type STRING,
  management_location STRING,
  market_effect_eligibility STRING,
  opening_frequency STRING,
  portfolio_type STRING,
  portfolio_type_sub_class STRING,
  region STRING,
  selection_strategy STRING,
  strategy STRING,
  structure STRING,
  subadvisor STRING,
  subadvisory STRING,
  commencement_op_calendar_day DATE,
  start_calendar_day DATE,
  stop_calendar_day DATE,
  trading_start_calendar_day DATE,
  trading_stop_calendar_day DATE,
  termination_calendar_day DATE,
  active_sel_approach STRING,
  alt_sub_asset_type STRING,
  asset_class STRING,
  asset_source STRING,
  company_stock STRING,
  advisory_bool BOOLEAN,
  currency_sector STRING,
  duration STRING,
  hedge_ast_mgmt_source STRING,
  hedge_ast_mgmt_source_code STRING,
  inv_approach STRING,
  inv_country_code STRING,
  inv_region STRING,
  inv_style STRING,
  inv_subregion STRING,
  market_cap STRING,
  nav_subattr_type STRING,
  nav_type STRING,
  product_strategy STRING,
  sector_fi STRING,
  style STRING,
  underlying STRING,
  underlying_code STRING,
  traded_on_exchange_flag STRING,
  isg_managed_bool BOOLEAN,
  fund_group STRING,
  fund_group_type STRING,
  sub_advised_flag STRING,
  corporate_action_system_flag STRING,
  do_not_invest_accrued_income_flag STRING,
  do_not_invest_disinvest_fx_for_flag STRING,
  do_not_invest_paid_income_flag STRING,
  fx_fund_trading_strategy_flag STRING,
  fx_trading_type_eligible_flag STRING,
  internal_crossing_eligible_flag STRING,
  ipo_eligible_flag STRING,
  latent_zero_sentinel_eligible_flag STRING,
  proxy_voting_discretion_flag STRING,
  securities_lending_status_flag STRING,
  soft_commission_eligible_flag STRING,
  ssga_fm_cta_client_sma_only_flag STRING,
  trade_order_routing_flag STRING,
  value_reported_to_aum_flag STRING,
  nsrd_fund_alias STRING,
  corporate_bool STRING,
  long_short_bool STRING,
  inv_grade_bool STRING,
  synthetic_exposure_over_90_bool STRING,
  portfolio_manager STRING,
  registration_flag STRING,
  traded_on_exchange STRING,
  legal_type_subclassification STRING,
  select_concentrated STRING,
  temc STRING,
  ldi STRING,
  exposure_management STRING,
  currency_hedged STRING,
  benchmark_code STRING,
  benchmark_name STRING,
  lqr_fund_cluster STRING,
  fund_proxy_account_id BIGINT,
  custody_alias STRING,
  isin_alias STRING,
  ticker_alias STRING,
  effective_timestamp TIMESTAMP NOT NULL,
  aggressiveness STRING,
  active_sel_approach_code STRING,
  alt_sub_asset_type_code STRING,
  approach STRING,
  approach_code STRING,
  asset_class_code STRING,
  asset_source_code STRING,
  company_stock_code STRING,
  currency_hedged_bool BOOLEAN,
  currency_sector_code STRING,
  duration_code STRING,
  exposure_management_bool BOOLEAN,
  inv_approach_code STRING,
  inv_country STRING,
  inv_region_code STRING,
  inv_style_code STRING,
  inv_subregion_code STRING,
  market_cap_code STRING,
  nav_subattr_type_code STRING,
  nav_type_code STRING,
  product_strategy_code STRING,
  sector_fi_code STRING,
  style_code STRING,
  syn_exp_bool BOOLEAN,
  temc_bool BOOLEAN,
  advisory STRING,
  isg_managed_flag STRING,
  contracting_entity STRING,
  accounting_currency STRING,
  lei STRING,
  proxy_account_prks_alias STRING,
  registration_type STRING,
  nsrd_fund_alias_start_day DATE,
  nsrd_fund_alias_stop_day DATE,
  portia_alias_start_day DATE,
  portia_alias_stop_day DATE,
  prks_alias_start_day DATE,
  prks_alias_stop_day DATE,
  custody_alias_start_day DATE,
  custody_alias_stop_day DATE,
  isin_start_day DATE,
  isin_stop_day DATE,
  ticker_start_day DATE,
  ticker_stop_day DATE,
  aladdin_alias_start_day DATE,
  aladdin_alias_stop_day DATE,
  champs_alias_start_day DATE,
  champs_alias_stop_day DATE,
  caca_alias STRING,
  caca_alias_start_day DATE,
  caca_alias_stop_day DATE,
  future_clearing_broker STRING,
  future_clearing_broker_parent STRING,
  futures_clearing_account STRING,
  ssga_data_source_base_id BIGINT NOT NULL,
  synthetic_fund_alias STRING,
  synthetic_fund_id BIGINT,
  fund_range STRING,
  custodian STRING,
  prime_broker STRING,
  ifast_alias STRING,
  ifast_alias_start_day DATE,
  ifast_alias_stop_day DATE
)
  USING DELTA
  TBLPROPERTIES('DELTA.FEATURE.ALLOWCOLUMNDEFAULTS' = 'SUPPORTED','delta.isolationLevel' = 'Serializable','delta.feature.timestampNtz' = 'supported');
  
  ALTER TABLE dim_ssga_fund ALTER COLUMN Effective_Timestamp DROP DEFAULT;
  ALTER TABLE dim_ssga_fund ALTER COLUMN Effective_Timestamp SET DEFAULT (TO_UTC_TIMESTAMP(CURRENT_TIMESTAMP(), CURRENT_TIMEZONE()));
            ;

CREATE TABLE IF NOT EXISTS dim_ssga_security (
  ssga_security_hist_id BIGINT NOT NULL,
  ssga_security_base_id BIGINT NOT NULL,
  ssga_batch_base_id BIGINT NOT NULL,
  ssga_security_id INT NOT NULL,
  accrued_factor DECIMAL(18, 8),
  asset_type STRING,
  amount_issued DECIMAL(30, 12),
  callable_flag STRING,
  convertible_flag STRING,
  collateral_type STRING,
  country_of_issuer_iso_code STRING,
  country_of_risk_iso_code STRING,
  coupon_rate DECIMAL(20, 4),
  coupon_type STRING,
  cusip STRING,
  dbrs_rating STRING,
  expected_maturity_calendar_day TIMESTAMP,
  fitch_lt_mmkt_rating STRING,
  fitch_lt_rating STRING,
  fitch_lt_rating_calendar_day TIMESTAMP,
  fitch_lt_rating_source STRING,
  fitch_lt_rating_type STRING,
  fitch_prog_mmkt_rating STRING,
  fitch_st_mmkt_rating STRING,
  fitch_st_rating STRING,
  fitch_st_rating_calendar_day TIMESTAMP,
  fitch_st_rating_source STRING,
  fitch_st_rating_type STRING,
  floater_flag STRING,
  fund_typ STRING,
  gics_industry_group_code STRING,
  gics_industry_group_name STRING,
  gics_sector_code STRING,
  gics_sector_name STRING,
  gics_industry_code STRING,
  gics_industry_name STRING,
  gics_sub_industry_code STRING,
  gics_sub_industry_name STRING,
  immediate_parent_id STRING,
  immediate_parent_name STRING,
  industry_group STRING,
  industry_sector STRING,
  industry_subgroup STRING,
  internal_security_id_mdf BIGINT,
  internal_security_id_gcdf DECIMAL(38, 0),
  internal_security_id_idr DECIMAL(38, 0),
  internal_security_id_fa STRING,
  isin STRING,
  issue_calendar_day TIMESTAMP,
  issuer_id BIGINT,
  issuer_industry STRING,
  issuer_name STRING,
  last_refix_calendar_day TIMESTAMP,
  market_sector_description STRING,
  maturity_calendar_day TIMESTAMP,
  moodys_lt_mmkt_rating STRING,
  moodys_lt_rating STRING,
  moodys_lt_rating_calendar_day TIMESTAMP,
  moodys_lt_rating_source STRING,
  moodys_lt_rating_type STRING,
  moodys_prog_mmkt_rating STRING,
  moodys_st_mmkt_rating STRING,
  moodys_st_rating STRING,
  moodys_st_rating_calendar_day TIMESTAMP,
  moodys_st_rating_source STRING,
  moodys_st_rating_type STRING,
  mortgage_credit_provider STRING,
  mortgage_series STRING,
  mortgage_servicer STRING,
  next_call_calendar_day TIMESTAMP,
  next_payment_calendar_day TIMESTAMP,
  next_put_calendar_day TIMESTAMP,
  next_reset_calendar_day TIMESTAMP,
  outstanding_amount DECIMAL(30, 12),
  par_amount DECIMAL(38, 14),
  putable_flag STRING,
  pv_asset_class STRING,
  pv_sector STRING,
  pv_sector_detail STRING,
  sp_lt_watchlist_direction STRING,
  sp_lt_watchlist_timestamp TIMESTAMP,
  sp_st_watchlist_direction STRING,
  sp_st_watchlist_timestamp TIMESTAMP,
  fitch_lt_watchlist_direction STRING,
  fitch_lt_watchlist_timestamp TIMESTAMP,
  fitch_st_watchlist_direction STRING,
  fitch_st_watchlist_timestamp TIMESTAMP,
  moodys_lt_watchlist_direction STRING,
  moodys_lt_watchlist_timestamp TIMESTAMP,
  moodys_st_watchlist_direction STRING,
  moodys_st_watchlist_timestamp TIMESTAMP,
  portia_key STRING,
  refix_frequency STRING,
  remaining_maturity DECIMAL(30, 12),
  repo_collateral_name STRING,
  repo_collateral_type STRING,
  repo_ext_calendar_day TIMESTAMP,
  repo_open_flag STRING,
  reset_index STRING,
  sec_days STRING,
  security_description STRING,
  security_type STRING,
  sector STRING,
  subsector STRING,
  sp_lt_mmkt_rating STRING,
  sp_lt_rating STRING,
  sp_lt_rating_calendar_day TIMESTAMP,
  sp_lt_rating_source STRING,
  sp_lt_rating_type STRING,
  sp_prog_mmkt_rating STRING,
  sp_st_mmkt_rating STRING,
  sp_st_rating STRING,
  sp_st_rating_calendar_day TIMESTAMP,
  sp_st_rating_source STRING,
  sp_st_rating_type STRING,
  sponsor STRING,
  ultimate_parent_name STRING,
  ultimate_parent STRING,
  yield_to_maturity DECIMAL(18, 7),
  underlying_type STRING,
  underlying_ssga_security_id STRING,
  report_timestamp TIMESTAMP,
  swap_type STRING,
  pay_leg_currency STRING,
  rec_leg_currency STRING,
  pay_leg_float_rate_ref STRING,
  rec_leg_float_rate_ref STRING,
  rec_leg_type STRING,
  rec_leg_fixed_rate DECIMAL(38, 16),
  pay_leg_type STRING,
  pay_leg_fixed_rate DECIMAL(38, 16),
  product_type STRING,
  otc_original_counterparty STRING,
  otc_start_timestamp TIMESTAMP,
  otc_end_timestamp TIMESTAMP,
  pay_leg_spread DECIMAL(30, 12),
  pay_leg_rolling_period_count INT,
  pay_leg_rolling_period_unit STRING,
  pay_leg_day_count STRING,
  pay_leg_reset_period_count INT,
  pay_leg_reset_period_unit STRING,
  pay_leg_reset_type STRING,
  rec_leg_spread DECIMAL(30, 12),
  rec_leg_rolling_period_count INT,
  rec_leg_rolling_period_unit STRING,
  rec_leg_day_count STRING,
  rec_leg_reset_period_count INT,
  rec_leg_reset_period_unit STRING,
  rec_leg_reset_type STRING,
  used_price_end DECIMAL(38, 16),
  base_index STRING,
  base_index_type STRING,
  base_index_value DECIMAL(30, 12),
  traded_fixed_rate DECIMAL(30, 12),
  otc_traded_backend_notional DECIMAL(30, 12),
  otc_traded_frontend_notional DECIMAL(30, 12),
  otc_contract_size DECIMAL(38, 16),
  repo_notice_period_count INT,
  repo_notice_period_unit STRING,
  strike_price DECIMAL(30, 12),
  sec_id STRING,
  private_placement_flag STRING,
  guarantor_id STRING,
  coupon_currency_iso_code STRING,
  coupon_payment_frequency BIGINT,
  expiration_timestamp TIMESTAMP,
  optn_id STRING,
  shares_outstanding DECIMAL(38, 6),
  bb_security_id STRING,
  not_in_stage_bool BOOLEAN,
  flag_144a STRING,
  is_reg_s STRING,
  inflation_linked_indicator STRING,
  type_of_bond STRING,
  future_category STRING,
  cadis_system_uptimestampd TIMESTAMP,
  effective_timestamp TIMESTAMP NOT NULL,
  final_maturity_date DATE,
  prks STRING,
  mch_id STRING,
  bb_id STRING,
  future_first_trade_date DATE,
  next_call_price DECIMAL(22, 6),
  next_put_price DECIMAL(22, 6),
  floater_spread DECIMAL(12, 3),
  future_contract_size DECIMAL(18, 2),
  future_first_delivery_date DATE,
  future_last_delivery_date DATE,
  gcdf_application_key STRING,
  clearing_exchange_code STRING,
  cins STRING,
  future_ric_root STRING,
  alt_root_alias STRING,
  executing_broker STRING
)
  USING DELTA
  TBLPROPERTIES('DELTA.FEATURE.ALLOWCOLUMNDEFAULTS' = 'SUPPORTED','delta.isolationLevel' = 'Serializable','delta.feature.timestampNtz' = 'supported');
  
  ALTER TABLE dim_ssga_security ALTER COLUMN Effective_Timestamp DROP DEFAULT;
  ALTER TABLE dim_ssga_security ALTER COLUMN Effective_Timestamp SET DEFAULT (TO_UTC_TIMESTAMP(CURRENT_TIMESTAMP(), CURRENT_TIMEZONE()));
            ;

CREATE TABLE IF NOT EXISTS dim_ssga_security_exchange (
  ssga_security_exchange_hist_id BIGINT NOT NULL,
  ssga_security_exchange_base_id BIGINT NOT NULL,
  ssga_batch_base_id BIGINT NOT NULL,
  issue_id BIGINT NOT NULL,
  ssga_security_id INT,
  issue_currency_iso_code STRING,
  sedol STRING,
  country_of_trading_iso_code STRING,
  primary_exchange_flag CHAR(1),
  mic_code STRING,
  rks_key STRING,
  ric STRING,
  ticker STRING,
  id_bb_unique STRING,
  not_in_stage_bool BOOLEAN,
  cadis_system_updated TIMESTAMP NOT NULL,
  id_bb_global STRING,
  composite_id_bb_global STRING,
  exch_code STRING,
  effective_timestamp TIMESTAMP NOT NULL
)
  USING DELTA
  TBLPROPERTIES('DELTA.FEATURE.ALLOWCOLUMNDEFAULTS' = 'SUPPORTED','delta.isolationLevel' = 'Serializable','delta.feature.timestampNtz' = 'supported');
  
  ALTER TABLE dim_ssga_security_exchange ALTER COLUMN Effective_Timestamp DROP DEFAULT;
  ALTER TABLE dim_ssga_security_exchange ALTER COLUMN Effective_Timestamp SET DEFAULT (TO_UTC_TIMESTAMP(CURRENT_TIMESTAMP(), CURRENT_TIMEZONE()));
            